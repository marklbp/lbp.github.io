<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>五险一金税</title>
	<link rel="stylesheet" type="text/css" href="plugins/bootstrap/3.3.5/css/bootstrap.min.css">
	<style type="text/css">
		.row-normal{
			margin-left: 0;
			margin-right: 0;
		}
		.table-cs .form-control{
			display: inline-block;
			width: 50%;
			color: #f00;
		}
		.table-cs .form-control.percent{
			width: 40%;
			background-color: transparent;
			border: 0;
			box-shadow: none;
		}
	</style>
  <script type="text/javascript">
    window.onmessage = function (e){ 
      console.log(e, 'copy')
      //alert(e)
    }
    top.postMessage({msg: 'ok'}, '*')
  </script>
</head>
<body>
	<div class="row row-normal">
		<div class="col-xs-12">
			<div class="h4 text-center">薪资计算</div>
			<div class="form-group">
				<div class="input-group">
					<span class="input-group-addon">税前薪资</span>
					<input class="form-control" type="text" id="input1">
					<span class="input-group-btn">
						<button type="button" class="btn btn-success" id="btn1">确定</button>
					</span>
				</div>
			</div>
			<div class="form-group">
				<div class="input-group">
					<span class="input-group-addon">社保缴费</span>
					<input class="form-control" type="text" id="input2" readonly>
				</div>
			</div>
			<div class="form-group">
				<div class="input-group">
					<span class="input-group-addon">公积金费</span>
					<input class="form-control" type="text" id="input3" readonly>
				</div>
			</div>
      <div class="form-group">
        <div class="input-group">
          <span class="input-group-addon">应税薪资</span>
          <input class="form-control" type="text" id="input6" readonly>
        </div>
      </div>
			<div class="form-group">
				<div class="input-group">
					<span class="input-group-addon">个人税费</span>
					<input class="form-control" type="text" id="input4" readonly>
				</div>
			</div>
			<div class="form-group">
				<div class="input-group">
					<span class="input-group-addon">税后薪资</span>
					<input class="form-control" type="text" id="input5" readonly>
				</div>
			</div>

			<table class="table table-striped table-bordered table-responsive table-condensed table-hover">
				<caption>2017年4月1日起上海市社保缴费基数范围3902～19512（元），2017年7月1日起上海市公积金个人和单位的缴费比例均为7%，缴费额度范围282～2732（元）。<br>2018年4月1日起上海市社保缴费基数范围4279～21396（元），2018年7月1日起上海市公积金个人和单位的缴费比例均为7%，缴费额度范围322～2996（元）</caption>
				<tbody>
					<tr>
						<td colspan="3" class="text-center"><strong>五险一金缴纳比例对照表</strong></td>
					</tr>
					<tr>
						<td><strong>项目</strong></td>
						<td><strong>单位</strong></td>
						<td><strong>个人</strong></td>
					</tr>
					<tr>
						<td>养老保险</td><td>21.00%</td><td >8.00%</td>
					</tr>
					<tr><td>医疗保险</td><td>11.00%</td><td >2.00%</td>
					</tr>
					<tr><td>工伤保险</td><td>0.50%</td><td >0</td>
					</tr>
					<tr><td>生育保险</td><td>1.00%</td><td >0</td>
					</tr>
					<tr><td>失业保险</td><td>1.50%</td><td >0.50%</td>
					</tr>
					<tr>
						<td>残保金</td><td>1.60%</td><td >0</td>
					</tr>
					<tr>
						<td>小计</td><td>36.60%</td><td >10.50%</td>
					</tr>
					<tr>
						<td>合计</td><td colspan="2">47.10%</td>
					</tr>
				</tbody>
			</table>

			<table class="table table-striped table-bordered table-responsive table-condensed table-hover">
        <caption>2018年新税改前个人所得税税率表（一），征税点：3500（元）<br>2018年新税改后个人所得税税率表（一），征税点：5000（元）</caption>
        <tbody>
          <tr>
              <th>级数</th>
              <th>税率(%)</th>
              <th>旧应税所得额(含税)</th>
              <th>旧速算扣除数</th>
              <th>新应税所得额(含税)</th>
              <th>新速算扣除数</th>
          </tr>
          <tr>
          	<td>1</td>
          	<td>3</td>
          	<td>不超过1500元的</td>
          	<td>0</td>
          	<td>不超过3000元的</td>
          	<td>0</td>
          </tr>
          <tr>
          	<td>2</td>
          	<td>10</td>
          	<td>超过1500元至4500元的部分</td>
          	<td>105</td>
          	<td>超过3000元至12000元的部分</td>
          	<td>210</td>
          </tr>
          <tr>
          	<td>3</td>
          	<td>20</td>
          	<td>超过4500元至9000元的部分</td>
          	<td>555</td>
          	<td>超过12000元至25000元的部分</td>
          	<td>1410</td>
          </tr>
          <tr>
          	<td>4</td>
          	<td>25</td>
          	<td>超过9000元至35000元的部分</td>
          	<td>1005</td>
          	<td>超过25000元至35000元的部分</td>
          	<td>2660</td>
          </tr>
          <tr>
          	<td>5</td>
          	<td>30</td>
          	<td>超过35000元至55000元的部分</td>
          	<td>2755</td>
          	<td>超过35000元至55000元的部分</td>
          	<td>4410</td>
          </tr>
          <tr>
          	<td>6</td>
          	<td>35</td>
          	<td>超过55000元至80000元的部分</td>
          	<td>5505</td>
          	<td>超过55000元至80000元的部分</td>
          	<td>7160</td>
          </tr>
          <tr>
          	<td>7</td>
          	<td>45</td>
          	<td>超过80000元的部分</td>
          	<td>13505</td>
          	<td>超过80000元的部分</td>
          	<td>15160</td>
          </tr>
        </tbody>
	    </table>
		</div>
	</div>
	<script src="plugins/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		$("#btn1").on("click",function() {
			var v1 = $("#input1").val();
			var data = getCalSalary(v1);
			var si = data.socialInsurance
			$("#input2").val(si.pension + '(养老) + ' + si.medicare + '(医疗) + ' + si.unemployment + '(失业)' + ' = ' + si.sum);
			$("#input3").val(data.accumulationFund);
			$("#input4").val(data.personalTaxes);
			$("#input5").val(data.personalPaid);
      $("#input6").val(data.personalPrePaid)
		})
		var anniversary = {
			pension: 8/100,
			medicare: 2/100,
			unemployment: .5/100,
			accumulationFund: 7/100,
			y2017: {
				min: 3902,
				max: 19512,
				amin: 282/2/7*100,
				amax: 2732/2/7*100,
				s: 3500,
				tax: function (n) {
					/*
						"0<<=1500": function (n) {return n * 3 / 100},
						"1500<<=4500": function (n) {return n * 10 / 100 - 105},
						"4500<<=9000": function (n) {return n * 20 / 100 - 555},
						"9000<<=35000": function (n) {return n * 25 / 100 - 1005},
						"35000<<=55000": function (n) {return n * 30 / 100 - 2755},
						"55000<<=80000": function (n) {return n * 35 / 100 - 5505},
						"80000<": function (n) {return n * 45 / 100 - 13505}
					 */
					if(n > 0 && n <= 1500){
						return n * 3 / 100
					}else if(n > 1500 && n <= 4500){
						return n * 10 / 100 - 105
					}else if(n > 4500 && n <= 9000){
						return n * 20 / 100 - 555
					}else if(n > 9000 && n <= 35000){
						return n * 25 / 100 - 1005
					}else if(n > 35000 && n <= 55000){
						return n * 30 / 100 - 2755
					}else if(n > 55000 && n <= 80000){
						return n * 35 / 100 - 5505
					}else if(n > 80000){
						return n * 45 / 100 - 13505
					}
				}
			},
			y2018: {
				min: 4279,
				max: 21396,
				amin: 322/2/7*100,
				amax: 2996/2/7*100,
				s: 5000,
				tax: function (n) {
					/*
						"0<<=3000": function (n) {return n * 3 / 100},
						"3000<<=12000": function (n) {return n * 10 / 100 - 210},
						"12000<<=25000": function (n) {return n * 20 / 100 - 1410},
						"25000<<=35000": function (n) {return n * 25 / 100 - 2660},
						"35000<<=55000": function (n) {return n * 30 / 100 - 4410},
						"55000<<=80000": function (n) {return n * 35 / 100 - 7160},
						"80000<": function (n) {return n * 45 / 100 - 15160}
					 */
					if(n > 0 && n <= 3000){
						return n * 3 / 100
					}else if(n > 3000 && n <= 1200){
						return n * 10 / 100 - 210
					}else if(n > 12000 && n <= 25000){
						return n * 20 / 100 - 1410
					}else if(n > 25000 && n <= 35000){
						return n * 25 / 100 - 2660
					}else if(n > 35000 && n <= 55000){
						return n * 30 / 100 - 4410
					}else if(n > 55000 && n <= 80000){
						return n * 35 / 100 - 7160
					}else if(n > 80000){
						return n * 45 / 100 - 15160
					}
				}
			}
		}
		function getCalSalary(v){
			var _y = new Date().getFullYear()
			_y = _y >= 2018 ? _y : 2017
			var y = 'y' + y
      while (!anniversary[y]) {
        y = 'y' + _y--;
      }
			var yMIN = anniversary[y].min
			var yMAX = anniversary[y].max
			var aMIN = anniversary[y].amin
			var aMAX = anniversary[y].amax
			var s = anniversary[y].s
			var pension = anniversary.pension
			var medicare = anniversary.medicare
			var unemployment = anniversary.unemployment
			var accumulationFund = anniversary.accumulationFund
			var data = {
				personalPay: v,
				socialInsurance: {
					pension: 0,
					medicare: 0,
					injury: 0,
					medicare: 0,
					unemployment: 0,
					sum: 0
				},
				accumulationFund: 0,
				personalTaxes: 0,
				personalPaid: 0
			}
			,v0 = 0;

			if(v <= yMIN){
				v0 = yMIN
			}else if(v > yMIN && v <= yMAX){
				v0 = v;
			}else{
				v0 = yMAX
			}

			var p = data.socialInsurance.pension = parseFloat(toFixed(v0 * pension,2));
			var m = data.socialInsurance.medicare = parseFloat(toFixed(v0 * medicare,2));
			var e = data.socialInsurance.unemployment = parseFloat(toFixed(v0 * unemployment,2));

			data.socialInsurance.sum = toFixed((p + m + e),2);

			if(v <= aMIN){
				v0 = aMIN
			}else if( v > aMIN && v <= aMAX){
				v0 = v
			}else{
				v0 = aMAX
			}

			var a = data.accumulationFund = toFixed((v0 * accumulationFund),2);

			v0 = parseFloat(toFixed(anniversary[y].tax(v - a - (p + m + e) - s), 2))

			data.personalTaxes = v0 > 0 ? v0 : 0;
      data.personalPrePaid = parseFloat(toFixed(v - a - (p + m + e) - s,2));
			data.personalPaid = parseFloat(toFixed(v - a - (p + m + e) - v0,2));

			return data;
		}

		var toFixed = 'function' == typeof Number.prototype.toFixed ? function(fen,n){
			n = isNaN(parseInt(n)) ? 0 : Math.abs(parseInt(n));
			fen = isNaN(parseFloat(fen)) ? 0 : parseFloat(fen);
			//var m = fen/Math.pow(10,n);
			//return m.toFixed(n)
			return fen.toFixed(n)
		}: function(fen,n){
			n = isNaN(parseInt(n)) ? 0 : Math.abs(parseInt(n));
			fen = isNaN(parseFloat(fen)) ? 0 : parseFloat(fen);
			//var arr = (fen/Math.pow(10,n)+'').split(".");
			var arr = (fen + '').split(".");
			var int = Number(arr[0]);
			var decimal = arr[1];
			//保留0位小数
			if(n <= 0)return decimal&&decimal[0] >= 5 ?  int + 1 : int;

			//没有小数点
			if(decimal === undefined)return int + '.' + new Array(n).join("0") + "0";

			var _arr = decimal.match(/\d/g);
			if(_arr.length <= n){
				//不够，后导补零
				_arr.push(new Array(n-_arr.length).join("0") + n == _arr.length ? "" : "0");
				return int + '.' + _arr.join("");
			}else{
				//够位数，看第n+1位与5的大小
				if(_arr[n] < 5)return int + '.' + _arr.slice(0,n).join("");

				_arr = Number(_arr.slice(0,n).join("")) + 1;

				if(_arr >= Math.pow(10,n)){

					return (int + 1) + '.' + (_arr + '').substring(1);

				}else{
					_arr += '';
					//前导补零
					_arr = new Array(n - _arr.length).join("0") + (n == _arr.length ? '' : '0') + _arr;
					return int + '.' + _arr;
				}
			}
		}
	</script>
</body>
</html>
